# Shared Background Context for hypothesis-test and research-ideas

**Date:** 2026-02-25
**Status:** Approved

## Problem

The `hypothesis-test` plugin generates hypotheses without any background context beyond what agents discover by scanning project files. The `research-ideas` plugin has a mature `_summarize-problem-context` skill that gathers rich background from multiple sources (repos, papers, URLs, web search). These two plugins should share the background generation capability, and each should be able to reuse background generated by the other.

## Design

### 1. New `shared-skills` Plugin

Create a hidden plugin that holds skills shared across plugins. No user-invocable skills.

```
plugins/shared-skills/
├── .claude-plugin/
│   └── plugin.json
└── skills/
    └── _summarize-problem-context/
        └── SKILL.md
```

**plugin.json:**
```json
{
  "name": "shared-skills",
  "description": "Internal shared skills used by other plugins",
  "version": "0.1.0",
  "author": { "name": "BLIS team" }
}
```

Register in `.claude-plugin/marketplace.json`.

### 2. _summarize-problem-context Skill Changes

Move from `plugins/research-ideas/skills/` to `plugins/shared-skills/skills/`.

**New argument:**
- `[OUTPUT_FILE]` (optional): Where to write output. Default: `[PROBLEM_DIR]/research.md`. Override for hypothesis-test: `[PROJECT_ROOT]/hypotheses/problem-context.md`.

**Output format:** When writing `problem-context.md`, use header "# Problem Context" instead of "# Research Document". Internal structure (Problem Statement + Background sections) remains identical.

No other changes to the skill logic — source gathering, parallel agents, and synthesis all stay the same.

### 3. hypothesis-test Flow: Add Background to Screen 1

> **Implementation note:** During implementation, the dedicated Screen 2 (Background) was consolidated into Screen 1 as a 4th question to streamline the user experience and maintain the existing 6-screen flow. The design below describes the original 7-screen plan; see the actual SKILL.md for the implemented 6-screen version.

Insert new **Screen 2: Background** after Setup, shift all subsequent screens.

| Screen | Type | Purpose |
|--------|------|---------|
| 1: Setup | Config | Project, focus area, count (unchanged) |
| **2: Background (NEW)** | **Config** | **Problem context sources** |
| 3: Generation Dashboard | Dashboard | Generate hypotheses (was Screen 2) |
| 4: Select & Execute | Config | Pick hypotheses + execution mode (was Screen 3) |
| 5: Approve Designs | Dashboard + Config | Scaffold + approve (was Screen 4) |
| 6: Testing Dashboard | Dashboard | Run experiments (was Screen 5) |
| 7: Commit | Config | Commit results (was Screen 6) |

#### Screen 2: Background

After Step 0 (detect project context), before launching hypothesis agents:

1. Check for existing `research.md` in `[PROJECT_ROOT]` (from `/research-ideas`)
2. Check for existing `hypotheses/problem-context.md` in `[PROJECT_ROOT]` (from previous `/hypothesis-test` run)

```
AskUserQuestion:
  questions:
    - question: "How should we gather background context for hypothesis generation?"
      header: "Background"
      multiSelect: false
      options:
        # Conditional — only if research.md exists:
        - label: "Use existing research.md background (Recommended)"
          description: "Reuse background from a previous /research-ideas session"
        # Conditional — only if problem-context.md exists:
        - label: "Use existing problem-context.md (Recommended)"
          description: "Reuse background from a previous /hypothesis-test session"
        # Always shown:
        - label: "Generate new background"
          description: "Select sources (repos, papers, URLs) and generate fresh context"
        - label: "Skip background"
          description: "Generate hypotheses without background context"
```

**If "Generate new":** Show source selection sub-screens (current repo, local repos, GitHub, papers, web search), then invoke `_summarize-problem-context` with `[OUTPUT_FILE]` = `[PROJECT_ROOT]/hypotheses/problem-context.md`.

**If reusing existing:** Read the file, extract the Background section, store as `[BACKGROUND_CONTENT]`.

**If "Skip":** No background gathered, agents scan project independently as before.

#### Feeding Background to Hypothesis Agents

The hypothesis agent prompt template gets a new field:

```
BACKGROUND_CONTEXT: |
  [content from problem-context.md or extracted background]
```

With instruction: "Use the following background context to inform your hypothesis generation. This provides domain knowledge and project understanding beyond what you find by scanning files."

The `_formulate-hypothesis` skill reads background context directly from `[PROJECT_ROOT]/hypotheses/problem-context.md` during its scan step, rather than receiving it as an argument. This simplifies the agent invocation — the parent skill only needs to ensure the file exists before launching agents.

#### Output

After background generation/selection, write to:
```
[PROJECT_ROOT]/hypotheses/problem-context.md
```

This file is shared by all hypotheses in that project.

### 4. research-ideas Flow Changes

Minimal changes to the existing Screen 2 (Background source selection).

**Before showing source type selection (Step 1.1):**

1. Check for `hypotheses/problem-context.md` in CWD
2. If found, add reuse option to the multi-select

```
AskUserQuestion:
  questions:
    - question: "Which sources should be used to gather background context?"
      header: "Background"
      multiSelect: true
      options:
        # NEW — only if problem-context.md exists:
        - label: "Use existing problem-context.md (Recommended)"
          description: "Reuse background from a previous /hypothesis-test session"
        # Existing options unchanged:
        - label: "Current repository (Recommended)"
          description: "Analyze the codebase in the current working directory"
        - label: "Other local repositories"
        - label: "GitHub repositories"
        - label: "Local documents"
        - label: "Remote papers or URLs"
        - label: "Web search"
        - label: "Skip background entirely"
```

**If reuse selected:** Read `problem-context.md`, extract Background, write into research.md's Background section. Skip `_summarize-problem-context` for that content.

**If not selected or doesn't exist:** Existing flow unchanged.

### 5. File Change Summary

| File | Change |
|------|--------|
| `plugins/shared-skills/` (NEW) | New plugin directory |
| `plugins/shared-skills/.claude-plugin/plugin.json` (NEW) | Plugin metadata |
| `plugins/shared-skills/skills/_summarize-problem-context/SKILL.md` (MOVED) | Moved from research-ideas, add `[OUTPUT_FILE]` arg |
| `plugins/research-ideas/skills/_summarize-problem-context/` | DELETE (moved to shared-skills) |
| `plugins/research-ideas/skills/research-ideas/SKILL.md` | Add cross-detection for `problem-context.md` in Screen 2 |
| `plugins/hypothesis-test/skills/hypothesis-test/SKILL.md` | Add Screen 2 (Background), update to 7-screen flow, feed background to agents |
| `plugins/hypothesis-test/skills/_formulate-hypothesis/SKILL.md` | Add optional `[BACKGROUND_CONTEXT]` argument |
| `.claude-plugin/marketplace.json` | Register `shared-skills` plugin |
